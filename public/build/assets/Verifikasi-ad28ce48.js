import{a as s,c as D,r as L,f as q,W as G,R as S,j as w,b as H,F as N,g as K}from"./app-1f983794.js";import{L as z}from"./LoadingButton-400cea86.js";import{P as E}from"./PrimaryButton-1766558d.js";import{G as B}from"./GuestLayout-60c6b91a.js";import{k as Q,Q as J}from"./react-toastify.esm-cdcdfc11.js";import{A as V}from"./AlertDialog-28db4d41.js";import{F as $,b as X}from"./InputLabel-54be9dba.js";import{S as Y,M as R}from"./Select-84efadcf.js";import"./styled-3ef61533.js";import"./ApplicationLogo-39bcd91b.js";import"./SecondaryButton-5237e034.js";import"./DialogTitle-94a3c1f5.js";import"./ownerWindow-6e1d3300.js";import"./createChainedFunction-0bab83cf.js";import"./isHostComponent-73d6e646.js";import"./Paper-52daf32d.js";import"./Typography-9b8e0d9b.js";import"./useControlled-0f9a5b2a.js";import"./createSvgIcon-ea852789.js";function Z({className:O="",disabled:j,children:x,...M}){return s(z,{variant:"contained",color:"error",...M,className:O,disabled:j,size:"small",children:s("div",{className:"font-semibold",children:x})})}var W={exports:{}};(function(O,j){(function(M,b){O.exports=b(L)})(q,function(x){return function(M){var b={};function u(i){if(b[i])return b[i].exports;var o=b[i]={i,l:!1,exports:{}};return M[i].call(o.exports,o,o.exports,u),o.l=!0,o.exports}return u.m=M,u.c=b,u.d=function(i,o,h){u.o(i,o)||Object.defineProperty(i,o,{enumerable:!0,get:h})},u.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},u.t=function(i,o){if(o&1&&(i=u(i)),o&8||o&4&&typeof i=="object"&&i&&i.__esModule)return i;var h=Object.create(null);if(u.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:i}),o&2&&typeof i!="string")for(var U in i)u.d(h,U,function(k){return i[k]}.bind(null,U));return h},u.n=function(i){var o=i&&i.__esModule?function(){return i.default}:function(){return i};return u.d(o,"a",o),o},u.o=function(i,o){return Object.prototype.hasOwnProperty.call(i,o)},u.p="",u(u.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(M,b,u){u.r(b);var i=u("react"),o=function(){var c=function(n,e){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var r in a)a.hasOwnProperty(r)&&(t[r]=a[r])},c(n,e)};return function(n,e){c(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),h=function(){return h=Object.assign||function(c){for(var n,e=1,t=arguments.length;e<t;e++){n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(c[a]=n[a])}return c},h.apply(this,arguments)},U=function(c,n){var e={};for(var t in c)Object.prototype.hasOwnProperty.call(c,t)&&n.indexOf(t)<0&&(e[t]=c[t]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(c);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(c,t[a])&&(e[t[a]]=c[t[a]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(n){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,a){e.call(navigator,n,t,a)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function k(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var _=function(c){o(n,c);function n(e){var t=c.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return n.prototype.componentDidMount=function(){var e=this,t=e.state,a=e.props;if(this.unmounted=!1,!k()){a.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),a.children&&typeof a.children!="function"&&console.warn("children must be a function")},n.prototype.componentDidUpdate=function(e){var t=this.props;if(!k()){t.onUserMediaError("getUserMedia not supported");return}var a=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),p=e.minScreenshotWidth!==t.minScreenshotWidth,f=e.minScreenshotHeight!==t.minScreenshotHeight;(r||p||f)&&(this.canvas=null,this.ctx=null),(a||r)&&(this.stopAndCleanup(),this.requestUserMedia())},n.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},n.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},n.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(n.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},n.prototype.getScreenshot=function(e){var t=this,a=t.state,r=t.props;if(!a.hasUserMedia)return null;var p=this.getCanvas(e);return p&&p.toDataURL(r.screenshotFormat,r.screenshotQuality)},n.prototype.getCanvas=function(e){var t=this,a=t.state,r=t.props;if(!this.video||!a.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var p=this.video.videoWidth,f=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var d=p/f;p=r.minScreenshotWidth||this.video.clientWidth,f=p/d,r.minScreenshotHeight&&f<r.minScreenshotHeight&&(f=r.minScreenshotHeight,p=f*d)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||p,this.canvas.height=(e==null?void 0:e.height)||f,this.ctx=this.canvas.getContext("2d")}var v=this,m=v.ctx,l=v.canvas;return m&&l&&(l.width=(e==null?void 0:e.width)||l.width,l.height=(e==null?void 0:e.height)||l.height,r.mirrored&&(m.translate(l.width,0),m.scale(-1,1)),m.imageSmoothingEnabled=r.imageSmoothing,m.drawImage(this.video,0,0,(e==null?void 0:e.width)||l.width,(e==null?void 0:e.height)||l.height),r.mirrored&&(m.scale(-1,1),m.translate(-l.width,0))),l},n.prototype.requestUserMedia=function(){var e=this,t=this.props,a=function(f,d){var v={video:typeof d<"u"?d:!0};t.audio&&(v.audio=typeof f<"u"?f:!0),e.requestUserMediaId++;var m=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(v).then(function(l){e.unmounted||m!==e.requestUserMediaId?n.stopMediaStream(l):e.handleUserMedia(null,l)}).catch(function(l){e.handleUserMedia(l)})};if("mediaDevices"in navigator)a(t.audioConstraints,t.videoConstraints);else{var r=function(f){return{optional:[{sourceId:f}]}},p=function(f){var d=f.deviceId;return typeof d=="string"?d:Array.isArray(d)&&d.length>0?d[0]:typeof d=="object"&&d.ideal?d.ideal:null};MediaStreamTrack.getSources(function(f){var d=null,v=null;f.forEach(function(C){C.kind==="audio"?d=C.id:C.kind==="video"&&(v=C.id)});var m=p(t.audioConstraints);m&&(d=m);var l=p(t.videoConstraints);l&&(v=l),a(r(d),r(v))})}},n.prototype.handleUserMedia=function(e,t){var a=this.props;if(e||!t){this.setState({hasUserMedia:!1}),a.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}a.onUserMedia(t)},n.prototype.render=function(){var e=this,t=this,a=t.state,r=t.props,p=r.audio;r.forceScreenshotSourceSize,r.onUserMedia,r.onUserMediaError,r.screenshotFormat,r.screenshotQuality,r.minScreenshotWidth,r.minScreenshotHeight,r.audioConstraints,r.videoConstraints,r.imageSmoothing;var f=r.mirrored,d=r.style,v=d===void 0?{}:d,m=r.children,l=U(r,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),C=f?h(h({},v),{transform:(v.transform||"")+" scaleX(-1)"}):v,g={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",h({autoPlay:!0,src:a.src,muted:!p,playsInline:!0,ref:function(y){e.video=y},style:C},l)),m&&m(g))},n.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},n}(i.Component);b.default=_},react:function(M,b){M.exports=x}}).default})})(W);var ee=W.exports;const te=D(ee);function Me({auth:O}){const{data:j,setData:x}=G({image:null}),[M,b]=S.useState(""),[u,i]=S.useState(!1),[o,h]=S.useState([]),[U,k]=S.useState(null),[_,c]=S.useState(!1),[n,e]=S.useState(!1),t=S.useRef(null),a=(g,y)=>{const P=g.split(","),T=P[0].match(/:(.*?);/)[1],F=atob(P[1]);let A=F.length;const I=new Uint8Array(A);for(;A--;)I[A]=F.charCodeAt(A);return new File([I],y,{type:T})},r=S.useCallback(()=>{k(t.current.getScreenshot()),c(!1)},[t]),p=S.useCallback(()=>{k(null),c(!0)},[t]),f=S.useCallback(g=>{b(g.target.value),c(!0)},[t]),d=()=>{i(!0)},v=(g,y)=>{i(!1),!(y&&y=="backdropClick")&&g&&C()},m=S.useCallback(g=>{e(!1),c(!0),h(g.filter(({kind:y})=>y==="videoinput"))},[h]),l=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(()=>{navigator.mediaDevices.enumerateDevices().then(m)}).catch(()=>{e(!0),J.error("Anda Menolak Akses Kamera..",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})},C=()=>{K.post("/upload",{_method:"patch",image:j.image})};return S.useEffect(()=>{if(U){const g=a(U,`${O.user.email}.png`),y=new DataTransfer;y.items.add(g),x("image",y.files[0])}},[U]),w(B,{children:[s(H,{title:"Verifikasi"}),w("div",{children:["Halo",s("span",{className:"font-semibold text-blue-500 underline underline-offset-2 mx-2",children:O.user.name}),"verifkasi foto dulu yaa , siapkan KRS/KTM dan ambil foto muka dengan jelas"]}),w("div",{children:[s("p",{className:"font-bold my-2",children:"Contoh Foto"}),s("img",{src:"/assets/verifikasi.png",alt:"foto"})]}),o.length>0&&_?w($,{fullWidth:!0,margin:"dense",variant:"standard",children:[s(X,{id:"select-device",children:"Pilih Device Kamera"}),w(Y,{labelId:"select-device",id:"demo-simple-select",label:"Age",value:M,onChange:f,children:[s(R,{disabled:!0,value:"",children:"Pilih salah satu dibawah"}),o.map((g,y)=>s(R,{value:g.deviceId,children:g.label||`Device ${y+1}`},y))]})]}):o.length>0?null:s("div",{className:"my-4 flex justify-center",children:s(E,{onClick:l,children:"Beri Akses Kamera"})}),n&&s("p",{className:"text-red-500 font-semibold",children:"Anda meblokir akses kamera , silahkan atur secara manual di web browser anda"}),_?w(N,{children:[s("div",{className:"my-4",children:s(te,{audio:!1,videoConstraints:{deviceId:M},ref:t,screenshotFormat:"image/jpeg"})}),s(E,{className:"w-full",onClick:r,children:"Ambil Foto"})]}):s(N,{}),U?w("div",{className:"flex flex-col gap-4 mt-4",children:[w("div",{className:"font-semibold flex justify-between items-center",children:[s("p",{children:"Hasil Foto"}),s("div",{className:"flex gap-2",children:s(Z,{onClick:p,color:"warning",children:"Ambil ulang"})})]}),s("figure",{children:s("img",{src:U,alt:"your face"})}),s(E,{color:"success",className:"w-full",onClick:d,children:"Kirim Foto"})]}):s("p",{className:"my-2",children:"Ambil Foto dulu yaa gan.."}),s(V,{open:u,handleClose:v,title:"Yakin ingin mengirim foto ini ?",content:"Foto ini akan di kirim ke panita sebagai bukti verifikasi"}),s(Q,{limit:5})]})}export{Me as default};
